# çº¿ç¨‹

[å‚è€ƒç½‘é¡µï¼šå»–](https://www.liaoxuefeng.com/wiki/1016959663602400/1017629247922688)

**ä½¿ç”¨æ¨¡å—ï¼š**  
`_thread`:ä½çº§æ¨¡å—  
`threading`:é«˜çº§æ¨¡å—,å·²å¯¹`_thread`è¿›è¡Œäº†å°è£…ï¼ˆå¸¸ç”¨ï¼‰  


**ä½¿ç”¨åŸç†ï¼š**  
ä»»ä½•è¿›ç¨‹é»˜è®¤å°±ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¯¥çº¿ç¨‹ç§°ä¸ºä¸»çº¿ç¨‹ï¼Œåå­—å«MainThreadã€‚  
ä¸»çº¿ç¨‹åˆå¯ä»¥å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œå­çº¿ç¨‹çš„åå­—åœ¨åˆ›å»ºæ—¶æŒ‡å®šã€‚  
åå­—ä»…ä»…åœ¨æ‰“å°æ—¶ç”¨æ¥æ˜¾ç¤ºï¼Œå®Œå…¨æ²¡æœ‰å…¶ä»–æ„ä¹‰ï¼Œå¦‚æœä¸èµ·åå­—Pythonå°±è‡ªåŠ¨ç»™çº¿ç¨‹å‘½åä¸ºThread-1ï¼ŒThread-2â€¦â€¦  


**ä½¿ç”¨æ–¹æ³•ï¼š**  
åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ–¹æ³•ï¼šæŠŠä¸€ä¸ªå‡½æ•°ä¼ å…¥å¹¶åˆ›å»ºThreadå®ä¾‹ï¼Œç„¶åè°ƒç”¨start()å¼€å§‹æ‰§è¡Œ


## ä¸€ã€åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹å¹¶ç­‰å¾…å…¶ç»“æŸ  

`current_thread()å‡½æ•°`ï¼šå®ƒæ°¸è¿œè¿”å›å½“å‰çº¿ç¨‹çš„å®ä¾‹


```python
import time, threading

# æ–°çº¿ç¨‹æ‰§è¡Œçš„ä»£ç :
def loop():
    print('thread %s is running...' % threading.current_thread().name)
    n = 0
    while n < 5:
        n = n + 1
        print('thread %s >>> %s' % (threading.current_thread().name, n))
        time.sleep(1)
    print('thread %s ended.' % threading.current_thread().name)

print('thread %s is running...' % threading.current_thread().name)
t = threading.Thread(target=loop, name='LoopThread')  # åˆ›å»ºçº¿ç¨‹å®ä¾‹
t.start()  # çº¿ç¨‹
t.join()   # ç­‰å¾…çº¿ç¨‹ç»“æŸåæ‰§è¡Œä¸‹åˆ—ä»£ç 
print('thread %s ended.' % threading.current_thread().name)


'''
# Output:

thread MainThread is running...
thread LoopThread is running...
thread LoopThread >>> 1
thread LoopThread >>> 2
thread LoopThread >>> 3
thread LoopThread >>> 4
thread LoopThread >>> 5
thread LoopThread ended.
thread MainThread ended.
'''
```







## äºŒã€ä¸ºé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªå¯¹è±¡æ—¶æŠŠå†…å®¹æ”¹ä¹±ï¼Œç”¨`threading.Lock()`åˆ›å»ºé”ï¼Œä½¿åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªæŒæœ‰è¯¥é”çš„çº¿ç¨‹åœ¨æ‰§è¡Œ

* `threading.Lock()`:åˆ›å»ºä¸€ä¸ªé”
* `lock.acquire()`ï¼šè·å–é”
* `lock.release()`ï¼šé‡Šæ”¾é”

**å¤šçº¿ç¨‹**å’Œ**å¤šè¿›ç¨‹**æœ€å¤§çš„ä¸åŒåœ¨äºï¼š  
å¤šè¿›ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªå˜é‡ï¼Œå„è‡ªæœ‰ä¸€ä»½æ‹·è´å­˜åœ¨äºæ¯ä¸ªè¿›ç¨‹ä¸­ï¼ˆç§æœ‰å˜é‡ï¼‰ï¼Œäº’ä¸å½±å“ï¼Œ  
å¤šçº¿ç¨‹ä¸­ï¼Œæ‰€æœ‰å˜é‡éƒ½ç”±æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ‰€ä»¥ï¼Œä»»ä½•ä¸€ä¸ªå˜é‡éƒ½å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼ˆå…¬æœ‰å˜é‡ï¼‰ï¼Œå› æ­¤ï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®æœ€å¤§çš„å±é™©åœ¨äºå¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¹ä¸€ä¸ªå˜é‡ï¼ŒæŠŠå†…å®¹ç»™æ”¹ä¹±äº†ã€‚


è¦ç¡®ä¿balanceè®¡ç®—æ­£ç¡®ï¼Œå°±è¦ç»™change_it()ä¸Šä¸€æŠŠé”ï¼Œå½“æŸä¸ªçº¿ç¨‹å¼€å§‹æ‰§è¡Œchange_it()æ—¶ï¼Œæˆ‘ä»¬è¯´ï¼Œè¯¥çº¿ç¨‹å› ä¸ºè·å¾—äº†é”ï¼Œå› æ­¤å…¶ä»–çº¿ç¨‹ä¸èƒ½åŒæ—¶æ‰§è¡Œchange_it()ï¼Œåªèƒ½ç­‰å¾…ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾åï¼Œè·å¾—è¯¥é”ä»¥åæ‰èƒ½æ”¹ã€‚

```python
import time, threading

# å‡å®šè¿™æ˜¯ä½ çš„é“¶è¡Œå­˜æ¬¾:
balance = 0
lock = threading.Lock()

def change_it(n):
    # å…ˆå­˜åå–ï¼Œç»“æœåº”è¯¥ä¸º0:
    global balance
    balance = balance + n
    balance = balance - n

def run_thread(n):
    for i in range(100000):
        # å…ˆè¦è·å–é”:
        lock.acquire()
        try:
            # æ”¾å¿ƒåœ°æ”¹å§:
            change_it(n)    # ç»™change_it(n)ä¸Šå¥½é”äº†ğŸ”’
        finally:
            # æ”¹å®Œäº†ä¸€å®šè¦é‡Šæ”¾é”:
            lock.release()

t1 = threading.Thread(target=run_thread, args=(5,))
t2 = threading.Thread(target=run_thread, args=(8,))
t1.start()
t2.start()
t1.join()
t2.join()
print(balance)


'''
# Output:

0
'''
```





## ä¸‰ã€å¤šæ ¸CPU

è¦æƒ³æŠŠNæ ¸CPUçš„æ ¸å¿ƒå…¨éƒ¨è·‘æ»¡ï¼Œå°±å¿…é¡»å¯åŠ¨Nä¸ªæ­»å¾ªç¯çº¿ç¨‹




1.æ­»å¾ªç¯ç¤ºä¾‹:  

```python

import threading, multiprocessing

def loop():
    x = 0
    while True:
        x = x ^ 1

for i in range(multiprocessing.cpu_count()):
    t = threading.Thread(target=loop)
    t.start()


'''
# Output:

'''

```











```python





'''
# Output:

'''

```











```python





'''
# Output:

'''

```